let timers = [
    { id: "display1", countdown: null, time: 0, isRunning: false, stopwatch: false, label: "Timer 1" },
    { id: "display2", countdown: null, time: 0, isRunning: false, stopwatch: false, label: "Timer 2" },
    { id: "display3", countdown: null, time: 0, isRunning: false, stopwatch: false, label: "Timer 3" },
    { id: "display4", countdown: null, time: 0, isRunning: false, stopwatch: false, label: "Timer 4" }
];

// Create the alarm sound using Audio
const alarmSound = new Audio("button-4.wav");
alarmSound.loop = true;  // Set the sound to loop indefinitely

function startTimer(timerIndex, minutes) {
    let additionalTimeInSeconds = minutes * 60;

    // If the timer is running, confirm if you want to add more time
    if (timers[timerIndex].isRunning) {
        // Ask user for confirmation to add more time
        if (confirm(`Do you want to add ${minutes} minutes to this timer?`)) {
            timers[timerIndex].time += additionalTimeInSeconds;
            updateDisplay(timerIndex);
        }
    } else {
        // Start the timer normally if it's not running
        timers[timerIndex].isRunning = true;
        timers[timerIndex].time = additionalTimeInSeconds;
        startCountdown(timerIndex);
    }
}

function startStopwatch(timerIndex) {
    if (timers[timerIndex].stopwatch) return; // Prevent multiple stopwatches

    let displayElement = document.getElementById(timers[timerIndex].id);
    let time = 0;

    timers[timerIndex].stopwatch = true;
    timers[timerIndex].countdown = setInterval(() => {
        time++;
        displayElement.innerText = formatTime(time);
    }, 1000);
}

function resetTimer(timerIndex) {
    clearInterval(timers[timerIndex].countdown);
    timers[timerIndex].isRunning = false;
    timers[timerIndex].stopwatch = false;
    timers[timerIndex].time = 0;
    document.getElementById(timers[timerIndex].id).innerText = '00:00';

    // Stop the alarm sound when the timer is reset
    alarmSound.pause();
    alarmSound.currentTime = 0;
}

function startCountdown(timerIndex) {
    let displayElement = document.getElementById(timers[timerIndex].id);
    displayElement.innerText = formatTime(timers[timerIndex].time);

    timers[timerIndex].countdown = setInterval(() => {
        timers[timerIndex].time--;
        updateDisplay(timerIndex);

        if (timers[timerIndex].time <= 0) {
            clearInterval(timers[timerIndex].countdown);
            timers[timerIndex].isRunning = false;
            displayElement.innerText = `${timers[timerIndex].label} Time's Up!`;

            // Play the alarm sound in a loop
            alarmSound.play();

            // Directly show the time options prompt
            handleSecondPrompt(timerIndex);
        }
    }, 1000);
}

function handleSecondPrompt(timerIndex) {
    // Stop the alarm sound from looping when the prompt appears
    alarmSound.pause();
    alarmSound.currentTime = 0;

    let userChoice = prompt(`Choose time to add to ${timers[timerIndex].label}:\n1. 30 minutes\n2. 1 hour\n3. Exit (reset timer)`);

    if (userChoice === "1") {
        timers[timerIndex].time += 30 * 60; // Add 30 minutes
        startCountdown(timerIndex);
    } else if (userChoice === "2") {
        timers[timerIndex].time += 60 * 60; // Add 1 hour
        startCountdown(timerIndex);
    } else if (userChoice === "3") {
        resetTimer(timerIndex);
    } else {
        alert("Invalid choice! Please choose '1', '2', or '3'.");
    }
}

function updateDisplay(timerIndex) {
    let displayElement = document.getElementById(timers[timerIndex].id);
    displayElement.innerText = formatTime(timers[timerIndex].time);
}

function formatTime(seconds) {
    let minutes = Math.floor(seconds / 60);
    let remainingSeconds = seconds % 60;
    return `${padZero(minutes)}:${padZero(remainingSeconds)}`;
}

function padZero(value) {
    return value < 10 ? "0" + value : value;
}
